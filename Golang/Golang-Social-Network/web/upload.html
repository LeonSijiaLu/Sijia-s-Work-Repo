<!DOCTYPE html>
<html lang="en">
  <head>

	    <!-- ==============================================
		Title and Meta Tags
		=============================================== -->
		<meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">  
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>TypInBlog</title>
		<meta name="description" content="" />
        <meta name="keywords" content="" />
        <meta property="og:title" content="" />
        <meta property="og:url" content="" />
        <meta property="og:description" content="" />		
		
		<!-- ==============================================
		Favicons
		=============================================== --> 
		<link rel="icon" href="assets/img/favicons/logo.png">
		<link rel="apple-touch-icon" href="assets/img/favicons/apple-touch-icon.png">
		<link rel="apple-touch-icon" sizes="72x72" href="img/favicons/apple-touch-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="114x114" href="img/favicons/apple-touch-icon-114x114.png">
		
	    <!-- ==============================================
		CSS
		=============================================== -->
        <link type="text/css" href="assets/css/demos/photo.css" rel="stylesheet" />
		<link type="text/css" href="assets/css/animate.css" rel="stylesheet" />
				
		<!-- ==============================================
		Feauture Detection
		=============================================== -->
		<script src="assets/js/modernizr-custom.js"></script>

		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
		  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
		  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->	
		
  </head>

<body>

     <!-- ==============================================
     Navigation Section
     =============================================== -->  
     <header class="tr-header">
      <nav class="navbar navbar-default">
       <div class="container-fluid">
	    <div class="navbar-header">
		 <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
		  <span class="sr-only">Toggle navigation</span>
		  <span class="icon-bar"></span>
		  <span class="icon-bar"></span>
		  <span class="icon-bar"></span>
		 </button>
		 <a class="navbar-brand" href=""><i class="fab"></i> TypInBlog</a>
		</div><!-- /.navbar-header -->
		<div class="navbar-left">
		 <div class="collapse navbar-collapse" id="navbar-collapse">
		  <ul class="nav navbar-nav">
		  </ul>
		 </div>
		</div><!-- /.navbar-left -->
		<div class="navbar-right">                          
		 <ul class="nav navbar-nav">
		   <li>
		   <div class="search-dashboard">
               <form>
                    <input id="search_content" placeholder="Search here" type="text">
                    <button type="button" id="search_button" onclick="setSearchResults();"><i class="fa fa-search"></i></button>
               </form>
          </div>							
		   </li>

		   <li class="dropdown notification-list">
		    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
			 <i class="fa fa-bell noti-icon"></i>
			 <span id="notifications_num" class="badge badge-danger badge-pill noti-icon-badge"></span>
			</a>
			<div class="dropdown-menu dropdown-menu-right dropdown-lg">
             
			 <div class="dropdown-item noti-title">
			  <h6 class="m-0">
			   <span class="pull-right">
			    <a style="cursor: pointer;" onclick="clearNotifications();"><small>Clear All</small></a> 
			   </span>Notification
			  </h6>
			 </div>

			 <div class="slimScrollDiv" style="position: relative; overflow: hidden; width: auto; height: 416.983px;">
			  <div class="slimscroll" style="max-height: 230px; overflow: hidden; width: auto; height: 416.983px;">
			   <div id="Slim"></div><!--/ .Slim-->
			   <div class="slimScrollBar" style="background: rgb(158, 165, 171) none repeat scroll 0% 0%; width: 8px; position: absolute; top: 0px; opacity: 0.4; display: block; border-radius: 7px; z-index: 99; right: 1px;"></div>
			   <div class="slimScrollRail" style="width: 8px; height: 100%; position: absolute; top: 0px; display: none; border-radius: 7px; background: rgb(51, 51, 51) none repeat scroll 0% 0%; opacity: 0.2; z-index: 90; right: 1px;"></div>
			  </div><!--/ .slimscroll-->
			 </div><!--/ .slimScrollDiv-->
			 <a style="display: none;" href="photo_notifications.html" class="dropdown-item text-center notify-all">
			  View all <i class="fa fa-arrow-right"></i>
			 </a><!-- All-->
            </div><!--/ dropdown-menu-->
		   </li>

		   <li class="dropdown notification-list" style="display: none;">
			<a class="nav-link dropdown-toggle arrow-none waves-effect" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
			 <i class="fa fa-envelope noti-icon"></i>
			 <span class="badge badge-success badge-pill noti-icon-badge">6</span>
			</a>
			<div class="dropdown-menu dropdown-menu-right dropdown-lg dropdown-new">
             <div class="dropdown-item noti-title">
			  <h6 class="m-0">
			   <span class="float-right">
			    <a href="" class="text-dark"><small>Clear All</small></a> 
			   </span>Chat
			  </h6>
			 </div>

			 <div class="slimScrollDiv" style="position: relative; overflow: hidden; width: auto; height: 416.983px;">
			  <div class="slimscroll" style="max-height: 230px; overflow: hidden; width: auto; height: 416.983px;">
			   <div id="Slim2">
				<a href="javascript:void(0);" class="dropdown-item notify-item nav-user">
				 <div class="notify-icon"><img src="assets/img/users/1.jpg" class="img-responsive img-circle" alt=""> </div>
				 <p class="notify-details">Cristina Pride</p>
				 <p class="text-muted font-13 mb-0 user-msg">Hi, How are you? What about our next meeting</p>
				</a><!--/ dropdown-item-->
				<a href="javascript:void(0);" class="dropdown-item notify-item nav-user">
				 <div class="notify-icon"><img src="assets/img/users/2.jpg" class="img-responsive img-circle" alt=""> </div>
				 <p class="notify-details">Sam Garret</p>
				 <p class="text-muted font-13 mb-0 user-msg">Yeah everything is fine</p>
				</a><!--/ dropdown-item-->
				<a href="javascript:void(0);" class="dropdown-item notify-item nav-user">
				 <div class="notify-icon"><img src="assets/img/users/3.jpg" class="img-responsive img-circle" alt=""> </div>
				 <p class="notify-details">Karen Robinson</p>
				 <p class="text-muted font-13 mb-0 user-msg">Wow that's great</p>
				</a><!--/ dropdown-item-->
				<a href="javascript:void(0);" class="dropdown-item notify-item nav-user">
				 <div class="notify-icon"><img src="assets/img/users/4.jpg" class="img-responsive img-circle" alt=""> </div>
				 <p class="notify-details">Sherry Marshall</p>
				 <p class="text-muted font-13 mb-0 user-msg">Hi, How are you? What about our next meeting</p>
				</a><!--/ dropdown-item-->
				<a href="javascript:void(0);" class="dropdown-item notify-item nav-user">
				 <div class="notify-icon"><img src="assets/img/users/5.jpg" class="img-responsive img-circle" alt=""> </div>
				 <p class="notify-details">Shawn Millard</p>
				 <p class="text-muted font-13 mb-0 user-msg">Yeah everything is fine</p>
				</a><!--/ dropdown-item-->
			   </div><!--/ .Slim-->
			   <div class="slimScrollBar" style="background: rgb(158, 165, 171) none repeat scroll 0% 0%; width: 8px; position: absolute; top: 0px; opacity: 0.4; display: block; border-radius: 7px; z-index: 99; right: 1px;"></div>
			   <div class="slimScrollRail" style="width: 8px; height: 100%; position: absolute; top: 0px; display: none; border-radius: 7px; background: rgb(51, 51, 51) none repeat scroll 0% 0%; opacity: 0.2; z-index: 90; right: 1px;"></div>
			  </div><!--/ slimscroll-->
			 </div> <!--/ slimScrollDiv-->
			 <a href="photo_chat.html" class="dropdown-item text-center notify-all">
			  View all <i class="fa fa-arrow-right"></i>
			 </a>
            </div><!--/ dropdown-menu-->
		   </li>
		  
		 <li class="dropdown mega-avatar">
		  <a class="dropdown-toggle" data-toggle="dropdown" aria-expanded="true" id="header_user_info"></a>
		  <div class="dropdown-menu w dropdown-menu-scale pull-right">
		   <a class="dropdown-item" href="/home" style="cursor: pointer;"><span>Home</span></a> 
		   <a class="dropdown-item" href="/exploring" style="cursor: pointer;"><span>Explore</span></a> 
		   <div class="dropdown-divider"></div>
		   <a class="dropdown-item" href="/upload" style="cursor: pointer;"><span>Upload</span></a> 
		   <a class="dropdown-item" href="/stories" style="cursor: pointer;"><span>Stories</span></a> 
		   <a class="dropdown-item" href="/view_profile" style="cursor: pointer;">Profile</a> 
		   <div class="dropdown-divider"></div>
		   <a class="dropdown-item" onclick="logout();" style="cursor: pointer;">Sign out</a>
		  </div>
		 </li><!-- /navbar-item -->	
		 
		 </ul><!-- /.sign-in -->   
		</div><!-- /.nav-right -->
       </div><!-- /.container -->
      </nav><!-- /.navbar -->
     </header><!-- Page Header --> 
  
	 <!-- ==============================================
	 Navbar Second Section
	 =============================================== -->
	<section id="upload-navigation-bar" class="nav-sec"></section>	
  
	 <!-- ==============================================
	 News Feed Section
	 =============================================== --> 
	 <section class="upload">
	  <div class="container">
	   <div class="row">
	    <div class="col-lg-12">  
		 <input id="upload_post_title" style="margin-bottom: 10px" class="form-control" placeholder="Title">
	     <div class="box">
		  <form>
		   	<textarea id="upload_post_content" class="form-control no-border" rows="3" placeholder="Type something..."></textarea>
		  </form>
		  <div class="box-footer clearfix">
		   <button id="upload_post_button" class="kafe-btn kafe-btn-mint-small pull-right btn-sm">Upload</button>
		   <input style="display:none" id="upload_images_button" type="file" accept="image/*" multiple/>
		   <ul class="nav nav-pills nav-sm">
			<li class="nav-item" id="upload_images_icon">
				<i class="fa fa-camera text-muted"></i>
			</li>
		   </ul>
		  </div>
		 </div>	
		</div>
	   </div>
	  <div><ul id="upload_images_preview" style="display: flex; list-style: none;"></ul></div>
	   <div class="row one-row">
	    <div class="col-lg-12">
	     <a href="https://picturepan2.github.io/instagram.css/" target="_blank"><h4>Your Latest Images</h4></a>
		</div>
	   </div>
	   
		<section id="upload_latest_images"></section>
	   
	  </div><!--/ container -->
	 </section><!--/ newsfeed -->
     <!-- ==============================================
	 Scripts
	 =============================================== -->
	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/bootstrap.min.js"></script>
	<script src="assets/js/bootstrap-notify.min.js"></script>
	<script src="assets/js/base.js"></script>
	<script src="assets/js/notify.js"></script>
	<script src="assets/js/search.js"></script>
	<script src="assets/js/account.js"></script>
	<script src="assets/js/notifications.js"></script>
	<script src="assets/plugins/slimscroll/jquery.slimscroll.js"></script>
	<script type="text/javascript">
	$.ajax({
		url: "/basics",
  		type: "GET",
  		timeout: 0,
		dataType: 'json',
		success: function(r){
			id = r.id;
			name = r.username;
			avatar = r.avatar;
			$('#header_user_info').html(
				$('#header_user_info').html() + '<span class="avatar w-32"><a href="/view_profile"><img src="users/'+id+'/profile/'+avatar+'" class="img-resonsive img-circle" width="25" height="25" alt="..."></a></span><span class="hidden-xs">'+name+'</span>'
			);
		},
		error: function(e){console.log(e);}
	});

	loadYourImages();

	$('#upload-navigation-bar').html(
		$('#upload-navigation-bar').html()+'<div class="d-flex justify-content-between"><div class="p-2 nav-icon-lg dark-black"><a class="nav-icon" href="/home"><em class="fa fa-home"></em><span>Home</span></a></div><div class="p-2 nav-icon-lg clean-black"><a class="nav-icon" href="/exploring"><em class="fa fa-crosshairs"></em><span>Explore</span></a></div><div class="p-2 nav-icon-lg mint-green"><a class="nav-icon" href="/upload"><em class="fab fa-instagram"></em><span>Upload</span></a></div><div class="p-2 nav-icon-lg clean-black"><a class="nav-icon" href="/stories"><em class="fa fa-align-left"></em><span>Stories</span></a></div><div class="p-2 nav-icon-lg dark-black"><a class="nav-icon" href="/view_profile"><em class="fa fa-user"></em><span>Profile</span></a></div></div>'
	);

	function loadYourImages(){
		$('#upload_latest_images').html("");
		$.ajax({
			url: "/api/images",
  			type: "GET",
  			timeout: 0,
			dataType: 'json',
			success: function(r){
				var latest_img_board = ""
				var img_length = r.images.length;
				$.each(r.images, function(index,image){
					if ((index + 1)%3 == 1){
						latest_img_board = latest_img_board + '<div class="row"><div class="col-lg-4 col-md-3 col-sm-6 col-xs-12"><div class="card"><div class="card-image"><img src="users/'+image.user_id+'/posts/'+image.post_id+'/'+image.image_name+'" class="img-responsive" alt="Image"/></div></div></div>'
					}else if ((index + 1)%3 == 0 || index + 1 == img_length){
						latest_img_board = latest_img_board + '<div class="col-lg-4 col-md-3 col-sm-6 col-xs-12"><div class="card"><div class="card-image"><img src="users/'+image.user_id+'/posts/'+image.post_id+'/'+image.image_name+'" class="img-responsive" alt="Image"/></div></div></div></div>'
					}else{
						latest_img_board = latest_img_board + '<div class="col-lg-4 col-md-3 col-sm-6 col-xs-12"><div class="card"><div class="card-image"><img src="users/'+image.user_id+'/posts/'+image.post_id+'/'+image.image_name+'" class="img-responsive" alt="Image"/></div></div></div>'
					}
				});
				$('#upload_latest_images').html($('#upload_latest_images').html() + latest_img_board);
			},
			error: function(e){console.log(e);}
		});
	}

	function reloadYourImages(){
		setTimeout(function(){loadYourImages();}, 700);
	}

	$(document).ready(function(){
		var images_num = 0;

		$('#upload_images_icon').click(function(){
			images_num = 0;
			$('#upload_images_button').val("");
			$('#upload_images_preview').html("");
			$('#upload_images_button').click();
		});

		$('#upload_images_button').change(function () {
			images_num = this.files.length;
			if(images_num > 9){
				images_num = 0;
				$('#upload_images_button').val('');
				notifyUser('Error!', 'The maximum number of images can upload is 9', 'danger', 3000);
			}else{
				if (images_num > 0 && images_num <= 9){
					$.each($(this.files), function(index, img){
						var oFReader = new FileReader();
						oFReader.readAsDataURL(img);
						oFReader.onload = function(oFREvent) {
							$('#upload_images_preview').html(
								$('#upload_images_preview').html() + '<li style="width: 10%; margin-right: 10px;"><img style="width: 100%;" src='+oFREvent.target.result+'><p>'+img.name+'</p></li>'
							);
    					};
					});
				}
			}
        });

		$('#upload_post_button').click(function(){
			if (images_num == 0 || images_num > 9){
				notifyUser('Error!', 'Please upload at least 1 image, and at most 9 images', 'danger', 3000);
			}else if($("#upload_post_title").val() == "" || $("#upload_post_content").val() == ""){
				notifyUser('Error!', 'People want to see your title and content', 'danger', 3000);
			}else{
				var form = new FormData();
				form.append("title", $("#upload_post_title").val());
				form.append("content", $("#upload_post_content").val());
				form.append("images_num", images_num);
				for (i = 0; i < $("#upload_images_button")[0].files.length; i++) {
					form.append("images", $("#upload_images_button")[0].files[i]);
				}

				$.ajax({
					url: "/api/post/add",
  					type: "POST",
  					timeout: 0,
  					processData: false,
  					mimeType: "multipart/form-data",
  					contentType: false,
					dataType: 'json',
  					data: form,
					success: function(r){
						notifyUser('Congrats!', 'Your post is uploaded', 'success', 3000);
						images_num = 0;
						reloadYourImages();
						$("#upload_post_title").val("");
						$("#upload_post_content").val("");
						$('#upload_images_button').val("");
						$('#upload_images_preview').html("");
					},
					error: function(e){
						notifyUser('Error!', 'Upload failed !', 'danger', 3000);
					}
				});
			}
		});

		$('#Slim,#Slim2').slimScroll({
	        height:"auto",
			position: 'right',
			railVisible: true,
			alwaysVisible: true,
			size:"8px",
		});	

		loadNotifications();
	});		
	</script>

  </body>
</html>
